<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å—ä—ë–º–æ–∫</title>

  <style>
    /* =========================================================
       Apple-ish structure: system font, consistent spacing,
       clear hierarchy, comfortable hit targets.
       ========================================================= */

    :root{
      /* --- Typography (system-first) --- */
      --font-sans: -apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text",
                   system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --font-mono: ui-monospace, "SF Mono", Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      /* macOS UI often feels like: body ~13, titles 15‚Äì17+ */
      --fs-title: 17px;
      --fs-subtitle: 15px;
      --fs-body: 13px;
      --fs-callout: 12px;
      --fs-caption: 11px;

      --lh-tight: 1.25;
      --lh-normal: 1.38;
      --lh-relaxed: 1.45;

      --w-regular: 400;
      --w-medium: 500;
      --w-semibold: 600;
      --w-bold: 700;

      /* --- Spacing scale (4pt-ish) --- */
      --s-1: 4px;
      --s-2: 8px;
      --s-3: 12px;
      --s-4: 16px;
      --s-5: 24px;
      --s-6: 32px;

      /* --- Hit area (Apple general rule 44x44) --- */
      --hit: 44px;

      /* --- Radii --- */
      --r-1: 12px;
      --r-2: 16px;
      --r-3: 20px;
      --r-pill: 999px;

      /* --- Colors / Materials (dark, glassy) --- */
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.52);

      --accent: rgba(122,162,255,1);
      --accent-fill: rgba(122,162,255,.20);
      --accent-stroke: rgba(122,162,255,.62);

      --warn-stroke: rgba(255,204,102,.55);

      --bg-0: #070812;
      --bg-1: #0a0b10;

      --glass: rgba(20,22,30,.38);
      --glass2: rgba(20,22,30,.26);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.09);
      --sep: rgba(255,255,255,.08);

      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --inset: inset 0 1px 0 rgba(255,255,255,.07);

      --ease: cubic-bezier(.2,.8,.2,1);
    }

    *{ box-sizing:border-box; }
    html{ font-size: 16px; }
    body{
      margin:0;
      font-family: var(--font-sans);
      color: var(--text);
      font-size: var(--fs-body);
      line-height: var(--lh-normal);
      letter-spacing: -0.01em;

      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;

      /* Tabular numbers feel more "system" for times/dates */
      font-variant-numeric: tabular-nums;

      background:
        radial-gradient(900px 650px at 20% 15%, rgba(122,162,255,.25) 0%, rgba(122,162,255,0) 58%),
        radial-gradient(900px 650px at 85% 25%, rgba(255,204,102,.18) 0%, rgba(255,204,102,0) 60%),
        radial-gradient(1100px 900px at 60% 82%, rgba(168,106,255,.16) 0%, rgba(168,106,255,0) 62%),
        linear-gradient(180deg, var(--bg-1) 0%, var(--bg-0) 100%);
      min-height:100vh;
      overflow-x:hidden;
    }

    /* subtle noise / texture */
    body::after{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,.05) 0 1px, rgba(255,255,255,0) 2px),
        radial-gradient(circle at 70% 80%, rgba(255,255,255,.04) 0 1px, rgba(255,255,255,0) 2px);
      background-size: 240px 240px, 280px 280px;
      opacity:.18;
      mix-blend-mode: overlay;
      z-index:0;
    }

    /* Layout margin ~16 (Apple often uses 16pt margins in components) */
    .wrap{
      position:relative;
      z-index:1;
      max-width: 1120px;
      margin: 0 auto;
      padding: var(--s-4);
      display:grid;
      grid-template-columns: 1.2fr 1fr;
      gap: var(--s-4);
    }
    @media (max-width: 980px){
      .wrap{ grid-template-columns:1fr; }
    }

    .card{
      position:relative;
      border-radius: var(--r-3);
      overflow:hidden;
      border: 1px solid var(--stroke2);
      background: var(--glass);
      box-shadow: var(--shadow), var(--inset);
      transform: translateZ(0);
    }

    @supports ((-webkit-backdrop-filter: blur(18px)) or (backdrop-filter: blur(18px))){
      .card{
        -webkit-backdrop-filter: blur(22px) saturate(1.22);
        backdrop-filter: blur(22px) saturate(1.22);
      }
      .head, .footer, form, .item, .day, .seg{
        -webkit-backdrop-filter: blur(14px) saturate(1.12);
        backdrop-filter: blur(14px) saturate(1.12);
      }
    }

    .card::before{
      content:"";
      position:absolute; inset:0;
      pointer-events:none;
      background:
        linear-gradient(120deg,
          rgba(255,255,255,.12) 0%,
          rgba(255,255,255,.03) 24%,
          rgba(255,255,255,0) 46%,
          rgba(255,255,255,.04) 74%,
          rgba(255,255,255,.10) 100%);
      opacity:.25;
      z-index:0;
    }
    .card > *{ position:relative; z-index:1; }

    /* Header */
    .head{
      padding: var(--s-3) var(--s-4); /* 12 / 16 */
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: var(--s-3);
      background: var(--glass2);
      border-bottom: 1px solid var(--sep);
      position:relative;
      overflow:hidden;
    }

    .title{
      font-size: var(--fs-title);
      font-weight: var(--w-semibold);
      line-height: var(--lh-tight);
      letter-spacing: -0.015em;
    }

    /* Right card ‚Äúsoft light‚Äù */
    #dayCard .dayHeadGlow{
      position:absolute;
      inset:-44px -44px auto -44px;
      height: 150px;
      pointer-events:none;
      opacity:.26;
      transition: opacity .18s var(--ease), filter .18s var(--ease);
      background:
        radial-gradient(560px 160px at 18% 68%, rgba(122,162,255,.24), transparent 62%),
        radial-gradient(420px 160px at 82% 62%, rgba(168,106,255,.18), transparent 64%),
        radial-gradient(520px 160px at 50% -10%, rgba(255,255,255,.06), transparent 55%);
      filter: saturate(1.05);
    }
    #dayCard.hasEvents .dayHeadGlow{ opacity:.52; }
    #dayCard.isTodaySel .dayHeadGlow{
      opacity:.55;
      background:
        radial-gradient(560px 160px at 18% 68%, rgba(122,162,255,.22), transparent 62%),
        radial-gradient(420px 160px at 82% 62%, rgba(255,204,102,.18), transparent 64%),
        radial-gradient(520px 160px at 50% -10%, rgba(255,255,255,.06), transparent 55%);
    }

    /* Segmented control */
    .seg{
      display:inline-flex;
      gap: 2px;
      padding: 2px;
      border-radius: var(--r-pill);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .seg button{
      min-height: var(--hit);
      min-width: var(--hit);
      padding: 0 var(--s-3);
      border:0;
      border-radius: var(--r-pill);
      background: transparent;
      color: var(--text);
      font: inherit;
      font-size: var(--fs-body);
      font-weight: var(--w-semibold);
      letter-spacing: -0.01em;
      cursor:pointer;
      transition: background .14s var(--ease), transform .06s ease, box-shadow .14s var(--ease);
      outline:none;
    }
    .seg button:hover{ background: rgba(255,255,255,.10); }
    .seg button:active{ transform: scale(.99); }
    .seg button:focus-visible{ box-shadow: 0 0 0 4px rgba(122,162,255,.14); }
    .seg button.isActive{
      background: rgba(122,162,255,.20);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
    }

    /* Buttons (44x44 target) */
    button{
      min-height: var(--hit);
      min-width: var(--hit);
      padding: 0 var(--s-3);
      border-radius: var(--r-pill);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color: var(--text);
      font: inherit;
      font-size: var(--fs-body);
      font-weight: var(--w-semibold);
      letter-spacing: -0.01em;
      cursor:pointer;
      transition: background .14s var(--ease), border-color .14s var(--ease), transform .06s ease, box-shadow .14s var(--ease);
      outline:none;
    }
    button:hover{
      background: rgba(255,255,255,.10);
      border-color: rgba(255,255,255,.16);
    }
    button:active{ transform: scale(.99); }
    button:focus-visible{
      box-shadow: 0 0 0 4px rgba(122,162,255,.14);
      border-color: rgba(122,162,255,.65);
    }
    button.primary{
      border-color: var(--accent-stroke);
      background: var(--accent-fill);
    }
    button.primary:hover{
      background: rgba(122,162,255,.26);
      border-color: rgba(122,162,255,.72);
    }

    /* Calendar */
    .calendar{ padding: var(--s-4); } /* 16 */

    .monthBar{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap: var(--s-3);
      margin-bottom: var(--s-3);
    }
    .month{
      font-size: var(--fs-title);
      font-weight: var(--w-semibold);
      letter-spacing: -0.015em;
      text-transform: capitalize;
      line-height: var(--lh-tight);
    }
    .hint{
      color: var(--muted);
      font-size: var(--fs-callout);
      line-height: var(--lh-normal);
    }

    .dow, .grid{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap: var(--s-2); /* 8 */
    }
    .dow{
      margin-bottom: var(--s-2);
      color: var(--muted2);
      font-size: var(--fs-caption);
      font-weight: var(--w-semibold);
      letter-spacing: .04em;
      text-transform: uppercase;
      user-select:none;
    }

    .day{
      min-height: 76px;
      padding: var(--s-3); /* 12 */
      border-radius: var(--r-2);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
      cursor:pointer;
      user-select:none;
      transition: background .14s var(--ease), border-color .14s var(--ease), transform .06s ease, box-shadow .14s var(--ease);
    }
    .day:hover{
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.16);
    }
    .day:active{ transform: scale(.99); }
    .out{ opacity:.45; }

    .num{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-weight: var(--w-semibold);
      line-height: var(--lh-tight);
    }
    .badge{
      font-size: var(--fs-caption);
      font-weight: var(--w-semibold);
      padding: 2px 8px;
      border-radius: var(--r-pill);
      border: 1px solid rgba(122,162,255,.55);
      background: rgba(122,162,255,.18);
    }

    .sel{
      border-color: rgba(122,162,255,.82);
      background:
        radial-gradient(160px 120px at 30% 20%, rgba(122,162,255,.18), transparent 58%),
        rgba(255,255,255,.05);
      box-shadow:
        0 10px 30px rgba(122,162,255,.12),
        0 0 0 4px rgba(122,162,255,.10),
        inset 0 1px 0 rgba(255,255,255,.08);
    }
    .today{
      outline: 2px dashed var(--warn-stroke);
      outline-offset: 2px;
    }

    /* Right side */
    .side{
      padding: var(--s-4);
      display:flex;
      flex-direction:column;
      gap: var(--s-4);
    }

    .list{
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--r-3);
      overflow:hidden;
      background: rgba(255,255,255,.04);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .item{
      padding: var(--s-3) var(--s-4);
      border-bottom:1px solid rgba(255,255,255,.08);
      cursor:pointer;
      background: rgba(255,255,255,.03);
      transition: background .14s var(--ease);
    }
    .item:last-child{ border-bottom:0; }
    .item:hover{ background: rgba(255,255,255,.06); }

    /* Form */
    form{
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--r-3);
      padding: var(--s-4);
      background: rgba(255,255,255,.04);
      display:grid;
      gap: var(--s-3);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }

    label{
      display:grid;
      gap: var(--s-2);
      font-size: var(--fs-caption);
      font-weight: var(--w-semibold);
      letter-spacing: -0.01em;
    }

    input, textarea{
      width:100%;
      min-height: var(--hit);
      border-radius: var(--r-2);
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      color: var(--text);
      padding: 10px var(--s-3);
      font: inherit;
      font-size: var(--fs-body);
      letter-spacing: -0.01em;
      outline:none;
      transition: border-color .14s var(--ease), box-shadow .14s var(--ease), background .14s var(--ease);
    }
    textarea{
      min-height: 120px;
      resize: vertical;
      padding: 10px var(--s-3);
      line-height: var(--lh-relaxed);
    }
    input::placeholder, textarea::placeholder{ color: rgba(255,255,255,.42); }

    input:focus, textarea:focus{
      border-color: rgba(122,162,255,.75);
      box-shadow: 0 0 0 4px rgba(122,162,255,.12);
      background: rgba(0,0,0,.24);
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--s-3);
    }
    @media (max-width:980px){ .row2{ grid-template-columns: 1fr; } }

    .actions{
      display:flex;
      justify-content:flex-end;
      gap: var(--s-2);
      flex-wrap:wrap;
    }

    .footer{
      padding: var(--s-3) var(--s-4);
      border-top: 1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.03);
      display:flex;
      justify-content:space-between;
      gap: var(--s-3);
      flex-wrap:wrap;
    }

    pre{
      margin:0;
      padding: var(--s-4);
      border-radius: var(--r-3);
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color: rgba(255,255,255,.78);
      font-family: var(--font-mono);
      font-size: 12px;
      line-height: 1.45;
      white-space: pre-wrap;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }

    @media (prefers-reduced-motion: reduce){
      *{ scroll-behavior:auto !important; transition:none !important; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <!-- LEFT: Calendar -->
    <div class="card">
      <div class="head">
        <div class="title">üé¨ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å—ä—ë–º–æ–∫</div>

        <div class="seg" role="group" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—é">
          <button id="prevBtn" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü">‚óÄ</button>
          <button id="todayBtn" aria-label="–°–µ–≥–æ–¥–Ω—è">–°–µ–≥–æ–¥–Ω—è</button>
          <button id="nextBtn" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü">‚ñ∂</button>
        </div>
      </div>

      <div class="calendar">
        <div class="monthBar">
          <div class="month" id="monthLabel">‚Äî</div>
          <div class="hint" id="monthStat">0 —Å—ä—ë–º–æ–∫</div>
        </div>

        <div class="dow">
          <div>–ü–Ω</div><div>–í—Ç</div><div>–°—Ä</div><div>–ß—Ç</div><div>–ü—Ç</div><div>–°–±</div><div>–í—Å</div>
        </div>

        <div class="grid" id="grid"></div>
      </div>

      <div class="footer">
        <button class="primary" id="copyDayBtn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≥—Ä—É–∑–∫—É –¥–Ω—è</button>
        <button id="downloadTxtBtn">–°–∫–∞—á–∞—Ç—å .txt</button>
      </div>
    </div>

    <!-- RIGHT: Day + form -->
    <div class="card" id="dayCard">
      <div class="head">
        <div class="dayHeadGlow" aria-hidden="true"></div>
        <div class="title">üìÖ <span id="selectedLabel">‚Äî</span></div>
        <button id="newBtn">–ù–æ–≤–∞—è</button>
      </div>

      <div class="side">
        <div>
          <div class="title" style="margin-bottom:8px;">–°—ä—ë–º–∫–∏ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å</div>
          <div class="hint">–ù–∞–∂–º–∏ –Ω–∞ –ø—É–Ω–∫—Ç, —á—Ç–æ–±—ã –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å. –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ –≤ –æ–¥–∏–Ω –¥–µ–Ω—å.</div>
        </div>

        <div class="list" id="eventList"></div>

        <form id="form">
          <div class="row2">
            <label>
              –ü—Ä–æ–µ–∫—Ç/–∫–ª–∏–µ–Ω—Ç
              <input id="project" placeholder="–ù–∞–ø—Ä: Fujifilm / TRAVELMORE" />
            </label>
            <label>
              –õ–æ–∫–∞—Ü–∏—è
              <input id="location" placeholder="–ö–∞—Ñ–µ / –æ—Ñ–∏—Å / —Å—Ç—É–¥–∏—è" />
            </label>
          </div>

          <div class="row2">
            <label>
              Call
              <input id="callTime" type="time" />
            </label>
            <label>
              Wrap
              <input id="wrapTime" type="time" />
            </label>
          </div>

          <label>
            –ê–¥—Ä–µ—Å/–ª–∏–Ω–∫
            <input id="address" placeholder="2GIS/Google Maps –∏–ª–∏ —Ç–µ–∫—Å—Ç–æ–º" />
          </label>

          <label>
            –ö–æ–Ω—Ç–∞–∫—Ç
            <input id="contact" placeholder="–ò–º—è + —Ç–µ–ª–µ—Ñ–æ–Ω" />
          </label>

          <label>
            –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ
            <textarea id="deliverables" placeholder="–û–ø–∏—à–∏ –∑–∞–¥–∞—á—É:&#10;‚Äî —Ñ–æ—Ä–º–∞—Ç / —Ö—Ä–æ–Ω–æ–º–µ—Ç—Ä–∞–∂&#10;‚Äî –∫–ª—é—á–µ–≤—ã–µ —Å–º—ã—Å–ª—ã&#10;‚Äî —Ä–µ—Ñ–µ—Ä–µ–Ω—Å—ã&#10;‚Äî –¥–µ–¥–ª–∞–π–Ω—ã"></textarea>
          </label>

          <label>
            –ö–æ–º–∞–Ω–¥–∞ (–ø–æ —Å—Ç—Ä–æ–∫–∞–º)
            <textarea id="crew" placeholder="–û–ø–µ—Ä–∞—Ç–æ—Ä: ...&#10;–ó–≤—É–∫: ..."></textarea>
          </label>

          <label>
            –ü–ª–∞–Ω/—Ç–∞–π–º–∏–Ω–≥ (–ø–æ —Å—Ç—Ä–æ–∫–∞–º)
            <textarea id="schedule" placeholder="10:00 ‚Äî –∏–Ω—Ç–µ—Ä–≤—å—é&#10;11:30 ‚Äî b-roll"></textarea>
          </label>

          <label>
            –¢–µ—Ö–Ω–∏–∫–∞
            <textarea id="gear" placeholder="–ö–∞–º–µ—Ä–∞, –æ–ø—Ç–∏–∫–∞, —Å–≤–µ—Ç, –∑–≤—É–∫..."></textarea>
          </label>

          <label>
            –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
            <textarea id="notes" placeholder="–ü–∞—Ä–∫–æ–≤–∫–∞, –ø—Ä–æ–ø—É—Å–∫, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è..."></textarea>
          </label>

          <div class="actions">
            <button type="button" id="deleteBtn">–£–¥–∞–ª–∏—Ç—å</button>
            <button class="primary" type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>

          <div class="hint">
            –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ (localStorage). –ï—Å–ª–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç (–∏–Ω–æ–≥–¥–∞ –≤ —Ä–µ–∂–∏–º–µ file://), —Ç–µ–∫—Å—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥–µ—Ç –≤ ¬´–ü—Ä–µ–≤—å—é –≤—ã–≥—Ä—É–∑–∫–∏¬ª.
          </div>
        </form>

        <div>
          <div class="title" style="margin-bottom:8px;">–ü—Ä–µ–≤—å—é –≤—ã–≥—Ä—É–∑–∫–∏</div>
          <pre id="preview">‚Äî</pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "shootCalendarData_simple_v2";

    const pad2 = n => String(n).padStart(2,"0");
    const toISO = d => `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    const parseISO = s => { const [y,m,dd]=s.split("-").map(Number); return new Date(y,m-1,dd); };
    const sameDay = (a,b) => a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate();
    const startMonth = d => new Date(d.getFullYear(), d.getMonth(), 1);

    const niceDate = d => d.toLocaleDateString("ru-RU",{day:"2-digit",month:"long",year:"numeric"});
    const weekday = d => d.toLocaleDateString("ru-RU",{weekday:"long"});
    const monthName = d => d.toLocaleDateString("ru-RU",{month:"long",year:"numeric"});

    const uid = () => Math.random().toString(16).slice(2) + "-" + Date.now().toString(16);

    const load = () => {
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(parsed && Array.isArray(parsed.events)) return parsed;
        }
      }catch(e){}
      const oldKeys = ["shootCalendarData_simple_v1", "shootCalendarData_simple_v1 ", "shootCalendarData_simple_v1\t"];
      for(const k of oldKeys){
        try{
          const rawOld = localStorage.getItem(k);
          if(!rawOld) continue;
          const parsedOld = JSON.parse(rawOld);
          if(parsedOld && Array.isArray(parsedOld.events)){
            localStorage.setItem(STORAGE_KEY, JSON.stringify(parsedOld));
            return parsedOld;
          }
        }catch(e){}
      }
      return { events: [] };
    };

    let data = load();
    const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify(data));

    let currentMonth = startMonth(new Date());
    let selectedDate = new Date();
    let selectedId = null;

    const grid = document.getElementById("grid");
    const monthLabel = document.getElementById("monthLabel");
    const monthStat = document.getElementById("monthStat");
    const selectedLabel = document.getElementById("selectedLabel");
    const eventList = document.getElementById("eventList");
    const preview = document.getElementById("preview");
    const dayCard = document.getElementById("dayCard");

    const btnPrev = document.getElementById("prevBtn");
    const btnToday = document.getElementById("todayBtn");
    const btnNext = document.getElementById("nextBtn");

    const f = {
      project: document.getElementById("project"),
      location: document.getElementById("location"),
      callTime: document.getElementById("callTime"),
      wrapTime: document.getElementById("wrapTime"),
      address: document.getElementById("address"),
      contact: document.getElementById("contact"),
      deliverables: document.getElementById("deliverables"),
      crew: document.getElementById("crew"),
      schedule: document.getElementById("schedule"),
      gear: document.getElementById("gear"),
      notes: document.getElementById("notes"),
    };

    const eventsByDate = iso =>
      data.events
        .filter(e => e.date===iso)
        .sort((a,b)=>(a.callTime||"").localeCompare(b.callTime||""));

    const countEventsInMonth = d => {
      const y=d.getFullYear(), m=d.getMonth();
      return data.events.filter(e => {
        const dd = parseISO(e.date);
        return dd.getFullYear()===y && dd.getMonth()===m;
      }).length;
    };

    function normalizeBullets(text){
      const lines = (text||"")
        .split("\n")
        .map(s => s.trim())
        .filter(Boolean);

      if(lines.length === 0) return "";
      return lines.map(s => "‚Ä¢ " + s).join("\n");
    }

    function buildExportText(){
      const iso = toISO(selectedDate);
      const list = eventsByDate(iso);

      const lines = [];
      lines.push(`üé¨ –°–™–Å–ú–û–ß–ù–´–ô –î–ï–ù–¨ ‚Äî ${niceDate(selectedDate)} (${weekday(selectedDate)})`);
      lines.push(`–ì–æ—Ä–æ–¥/—á–∞—Å–æ–≤–æ–π –ø–æ—è—Å: –ê–ª–º–∞—Ç—ã (Asia/Almaty)`);
      lines.push("");

      if(list.length===0){
        lines.push("–°—ä—ë–º–æ–∫ –≤ —ç—Ç–æ—Ç –¥–µ–Ω—å –Ω–µ—Ç.");
        return lines.join("\n");
      }

      list.forEach((e,i)=>{
        lines.push("‚Äî ‚Äî ‚Äî");
        lines.push(`üé• –ü—Ä–æ–µ–∫—Ç #${i+1}`);

        if(e.project) lines.push(`–ü—Ä–æ–µ–∫—Ç/–∫–ª–∏–µ–Ω—Ç: ${e.project}`);
        if(e.callTime) lines.push(`Call: ${e.callTime}`);
        if(e.wrapTime) lines.push(`Wrap: ${e.wrapTime}`);
        if(e.location) lines.push(`–õ–æ–∫–∞—Ü–∏—è: ${e.location}`);
        if(e.address) lines.push(`–ê–¥—Ä–µ—Å/–æ—Ä–∏–µ–Ω—Ç–∏—Ä: ${e.address}`);
        if(e.contact) lines.push(`–ö–æ–Ω—Ç–∞–∫—Ç: ${e.contact}`);

        if(e.deliverables){
          const b = normalizeBullets(e.deliverables);
          lines.push("");
          lines.push("–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:");
          lines.push(b || e.deliverables);
        }

        if(e.crew){
          const b = normalizeBullets(e.crew);
          lines.push("");
          lines.push("–ö–æ–º–∞–Ω–¥–∞:");
          lines.push(b || e.crew);
        }

        if(e.schedule){
          const b = normalizeBullets(e.schedule);
          lines.push("");
          lines.push("–ü–ª–∞–Ω / —Ç–∞–π–º–∏–Ω–≥:");
          lines.push(b || e.schedule);
        }

        if(e.gear){
          const b = normalizeBullets(e.gear);
          lines.push("");
          lines.push("–¢–µ—Ö–Ω–∏–∫–∞:");
          lines.push(b || e.gear);
        }

        if(e.notes){
          lines.push("");
          lines.push("–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:");
          lines.push(e.notes);
        }

        lines.push("");
      });

      lines.push("‚úÖ –ï—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è –ø–ª–∞–Ω ‚Äî –ø–∏—à–µ–º –≤ –æ–±—â–∏–π —á–∞—Ç —Å—Ä–∞–∑—É.");
      return lines.join("\n");
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        alert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ üëç –í—Å—Ç–∞–≤–ª—è–π –≤ —á–∞—Ç –∫–æ–º–∞–Ω–¥—ã.");
      }catch(e){
        preview.textContent = text;
        alert("–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –¥–∞–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –¢–µ–∫—Å—Ç —É–∂–µ –≤ ¬´–ü—Ä–µ–≤—å—é –≤—ã–≥—Ä—É–∑–∫–∏¬ª ‚Äî –≤—ã–¥–µ–ª–∏ –∏ —Å–∫–æ–ø–∏—Ä—É–π –≤—Ä—É—á–Ω—É—é.");
      }
    }

    function downloadText(filename, text){
      const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function clearForm(){
      selectedId = null;
      Object.values(f).forEach(el => el.value = "");
    }

    function fillForm(e){
      f.project.value = e.project||"";
      f.location.value = e.location||"";
      f.callTime.value = e.callTime||"";
      f.wrapTime.value = e.wrapTime||"";
      f.address.value = e.address||"";
      f.contact.value = e.contact||"";
      f.deliverables.value = e.deliverables||"";
      f.crew.value = e.crew||"";
      f.schedule.value = e.schedule||"";
      f.gear.value = e.gear||"";
      f.notes.value = e.notes||"";
    }

    function setSegTodayActive(isActive){
      btnToday.classList.toggle("isActive", !!isActive);
    }

    function render(){
      monthLabel.textContent = monthName(currentMonth);
      monthStat.textContent = `${countEventsInMonth(currentMonth)} —Å—ä—ë–º–æ–∫`;
      selectedLabel.textContent = `${niceDate(selectedDate)} (${weekday(selectedDate)})`;

      preview.textContent = buildExportText();

      const today = new Date();
      const dayIso = toISO(selectedDate);
      const dayList = eventsByDate(dayIso);

      dayCard.classList.toggle("hasEvents", dayList.length > 0);
      dayCard.classList.toggle("isTodaySel", sameDay(selectedDate, today));
      setSegTodayActive(sameDay(selectedDate, today));

      grid.innerHTML = "";
      const first = startMonth(currentMonth);
      const offset = (first.getDay()+6)%7; // Monday first
      const start = new Date(first);
      start.setDate(first.getDate()-offset);

      for(let i=0;i<42;i++){
        const d = new Date(start);
        d.setDate(start.getDate()+i);
        const iso = toISO(d);

        const inMonth = d.getMonth()===currentMonth.getMonth();
        const isSel = sameDay(d, selectedDate);
        const isToday = sameDay(d, today);
        const count = eventsByDate(iso).length;

        const cell = document.createElement("div");
        cell.className = "day" + (inMonth?"":" out") + (isSel?" sel":"") + (isToday?" today":"");
        cell.innerHTML = `
          <div class="num">
            <span>${d.getDate()}</span>
            ${count?`<span class="badge">${count}</span>`:""}
          </div>
        `;
        cell.onclick = () => {
          selectedDate = d;
          selectedId = null;
          clearForm();
          render();
        };
        grid.appendChild(cell);
      }

      eventList.innerHTML = "";

      if(dayList.length===0){
        const empty = document.createElement("div");
        empty.className="item";
        empty.style.color="var(--muted)";
        empty.textContent = "–í —ç—Ç–æ—Ç –¥–µ–Ω—å –ø–æ–∫–∞ –Ω–µ—Ç —Å—ä—ë–º–æ–∫.";
        eventList.appendChild(empty);
      }else{
        dayList.forEach(e=>{
          const item=document.createElement("div");
          item.className="item";

          const title = (e.project || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è").trim();
          const metaParts = [];
          metaParts.push(e.callTime ? ("Call: " + e.callTime) : "Call: ‚Äî");
          if(e.location) metaParts.push(e.location);

          item.innerHTML = `
            <div style="font-weight:600; letter-spacing:-0.01em;">${title.replaceAll("<","&lt;").replaceAll(">","&gt;")}</div>
            <div style="color:var(--muted); font-size:12px; margin-top:6px;">${metaParts.join(" ‚Ä¢ ")}</div>
          `;

          item.onclick=()=>{
            selectedId=e.id;
            fillForm(e);
          };

          eventList.appendChild(item);
        });
      }
    }

    btnPrev.onclick = () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()-1, 1);
      render();
    };
    btnNext.onclick = () => {
      currentMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth()+1, 1);
      render();
    };
    btnToday.onclick = () => {
      selectedDate = new Date();
      currentMonth = startMonth(new Date());
      clearForm();
      render();
    };

    document.getElementById("newBtn").onclick = () => { clearForm(); };

    document.getElementById("copyDayBtn").onclick = async () => {
      await copyText(buildExportText());
    };

    document.getElementById("downloadTxtBtn").onclick = () => {
      const iso = toISO(selectedDate);
      downloadText(`shoot-day_${iso}.txt`, buildExportText());
    };

    document.getElementById("form").addEventListener("submit",(ev)=>{
      ev.preventDefault();

      const payload = {
        id: selectedId || uid(),
        date: toISO(selectedDate),
        project: f.project.value.trim(),
        location: f.location.value.trim(),
        callTime: f.callTime.value,
        wrapTime: f.wrapTime.value,
        address: f.address.value.trim(),
        contact: f.contact.value.trim(),
        deliverables: f.deliverables.value.trim(),
        crew: f.crew.value.trim(),
        schedule: f.schedule.value.trim(),
        gear: f.gear.value.trim(),
        notes: f.notes.value.trim(),
      };

      const idx = data.events.findIndex(e=>e.id===payload.id);
      if(idx>=0) data.events[idx]=payload;
      else data.events.push(payload);

      save();
      render();
      alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ");
    });

    document.getElementById("deleteBtn").onclick = () => {
      if(!selectedId){
        alert("–ù–µ—á–µ–≥–æ —É–¥–∞–ª—è—Ç—å: –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ —Å—ä—ë–º–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞.");
        return;
      }
      if(!confirm("–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—ä—ë–º–∫—É?")) return;

      data.events = data.events.filter(e=>e.id!==selectedId);
      save();
      clearForm();
      render();
    };

    render();
  </script>
</body>
</html>
